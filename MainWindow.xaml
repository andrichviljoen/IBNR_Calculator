<Window x:Class="IBNRCalculator.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:IBNRCalculator.ViewModels"
        mc:Ignorable="d"
        Title="IBNR Calculator"
        Height="720"
        Width="1100">
    <Window.DataContext>
        <vm:ReservingViewModel />
    </Window.DataContext>

    <DockPanel Margin="16">
        <StackPanel DockPanel.Dock="Top" Orientation="Vertical" Margin="0 0 0 12">
            <TextBlock Text="Input" FontWeight="Bold" FontSize="16" Margin="0 0 0 6" />
            <UniformGrid Columns="2" Rows="6" Margin="0 0 0 12" HorizontalAlignment="Left" Width="560">
                <CheckBox Content="Use bundled sample data" IsChecked="{Binding UseSample}" />
                <TextBlock Text="" />

                <TextBlock Text="Access database path" VerticalAlignment="Center" />
                <TextBox Text="{Binding DatabasePath, UpdateSourceTrigger=PropertyChanged}" Margin="4 0" />

                <TextBlock Text="Table name" VerticalAlignment="Center" />
                <TextBox Text="{Binding TableName, UpdateSourceTrigger=PropertyChanged}" Margin="4 0" />

                <TextBlock Text="Accident column" VerticalAlignment="Center" />
                <TextBox Text="{Binding AccidentColumn, UpdateSourceTrigger=PropertyChanged}" Margin="4 0" />

                <TextBlock Text="Underwriting column" VerticalAlignment="Center" />
                <TextBox Text="{Binding UnderwritingColumn, UpdateSourceTrigger=PropertyChanged}" Margin="4 0" />

                <TextBlock Text="Payment column" VerticalAlignment="Center" />
                <TextBox Text="{Binding PaymentColumn, UpdateSourceTrigger=PropertyChanged}" Margin="4 0" />

                <TextBlock Text="Amount column" VerticalAlignment="Center" />
                <TextBox Text="{Binding AmountColumn, UpdateSourceTrigger=PropertyChanged}" Margin="4 0" />

                <TextBlock Text="Date format (e.g. yyyyMMdd or yyyyQQ)" VerticalAlignment="Center" />
                <TextBox Text="{Binding DateFormat, UpdateSourceTrigger=PropertyChanged}" Margin="4 0" />
            </UniformGrid>

            <UniformGrid Columns="3" Rows="2" Margin="0 0 0 12" HorizontalAlignment="Left" Width="560">
                <StackPanel Orientation="Horizontal" Margin="0 0 8 0">
                    <TextBlock Text="Origin" Width="60" VerticalAlignment="Center" />
                    <ComboBox Width="160" SelectedItem="{Binding OriginType}" ItemsSource="{Binding Source={x:Static vm:OriginTypes.All}}" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0 0 8 0">
                    <TextBlock Text="Grain" Width="60" VerticalAlignment="Center" />
                    <ComboBox Width="160" SelectedItem="{Binding OriginGrain}" ItemsSource="{Binding Source={x:Static vm:OriginGrains.All}}" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0 0 8 0">
                    <TextBlock Text="Dev (months)" Width="90" VerticalAlignment="Center" />
                    <TextBox Width="80" Text="{Binding DevelopmentMonths, UpdateSourceTrigger=PropertyChanged}" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0 0 8 0">
                    <TextBlock Text="Allowed steps" Width="90" VerticalAlignment="Center" />
                    <TextBox Width="160" Text="{Binding AllowedSteps, UpdateSourceTrigger=PropertyChanged}" ToolTip="Comma separated development step indexes" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0 0 8 0">
                    <Button Content="Calculate" Width="120" Command="{Binding RunCommand}" />
                </StackPanel>
                <StackPanel Orientation="Horizontal" Margin="0 0 8 0">
                    <TextBlock Text="Status:" FontWeight="Bold" VerticalAlignment="Center" />
                    <TextBlock Text="{Binding Status}" Margin="6 0" VerticalAlignment="Center" />
                </StackPanel>
            </UniformGrid>
        </StackPanel>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="2*" />
                <RowDefinition Height="2*" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <GroupBox Header="Selected link ratios" Padding="6" Margin="0 0 0 8">
                <DataGrid ItemsSource="{Binding LinkRatios}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="From" Binding="{Binding FromDevelopment}" />
                        <DataGridTextColumn Header="To" Binding="{Binding ToDevelopment}" />
                        <DataGridTextColumn Header="Factor" Binding="{Binding Factor, StringFormat=F3}" />
                        <DataGridTextColumn Header="Observations" Binding="{Binding ObservationCount}" />
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <GroupBox Grid.Row="1" Header="Origin ultimates and IBNR" Padding="6" Margin="0 8 0 8">
                <DataGrid ItemsSource="{Binding OriginSummaries}" AutoGenerateColumns="False" IsReadOnly="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="Origin" Binding="{Binding OriginKey}" />
                        <DataGridTextColumn Header="Latest" Binding="{Binding LatestCumulative, StringFormat=N0}" />
                        <DataGridTextColumn Header="Ultimate" Binding="{Binding Ultimate, StringFormat=N0}" />
                        <DataGridTextColumn Header="IBNR" Binding="{Binding IncurredButNotReported, StringFormat=N0}" />
                    </DataGrid.Columns>
                </DataGrid>
            </GroupBox>

            <GroupBox Grid.Row="2" Header="Guidance" Padding="6">
                <TextBlock TextWrapping="Wrap">
                    Use the controls above to map your Access columns, supply a custom date format (including quarter codes such as yyyyQQ),
                    and optionally restrict development steps. Click Calculate to load transactions, build triangles, and project ultimates
                    with the chain ladder factors shown in the Link Ratios grid.
                </TextBlock>
            </GroupBox>
        </Grid>
    </DockPanel>
</Window>
